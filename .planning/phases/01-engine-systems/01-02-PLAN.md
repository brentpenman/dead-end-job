---
phase: 01-engine-systems
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - js/inventory.js
  - css/inventory.css
autonomous: true

must_haves:
  truths:
    - "Player clicks a pickup hotspot and the item appears in the inventory bar at the bottom"
    - "Player clicks an inventory item to select it, then clicks a hotspot to use the item on it"
    - "Player right-clicks or examines an inventory item to see its text description"
    - "When an item is used correctly, it is removed from inventory"
  artifacts:
    - path: "js/inventory.js"
      provides: "Inventory pickup, selection, use-on-hotspot, examine, removal"
      contains: "Inventory"
    - path: "css/inventory.css"
      provides: "Inventory bar styling, item slots, selection highlight, examine tooltip"
      contains: "inventory"
  key_links:
    - from: "js/inventory.js"
      to: "js/game.js"
      via: "Inventory reads/writes Game.inventory array and calls Game.addItem/removeItem"
      pattern: "Game\\.(addItem|removeItem|hasItem|inventory)"
    - from: "js/inventory.js"
      to: "js/scene.js"
      via: "Scene hotspot click dispatches to Inventory.pickUp for pickup-type hotspots"
      pattern: "Inventory\\.pickUp"
    - from: "js/inventory.js"
      to: "js/cursor.js"
      via: "When inventory item is selected, cursor changes to use mode"
      pattern: "Cursor\\.setMode"
---

<objective>
Build the inventory system: picking up items from scenes, displaying them in the inventory bar, selecting items, using items on hotspots, examining items, and removing used items.

Purpose: Inventory puzzles are the core mechanic of the game. Without pickup/use/examine, there are no puzzles.
Output: A working inventory bar where the player can pick up test items, select them, use them on hotspots, examine them, and see them removed on correct use.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-engine-systems/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Inventory bar, pickup, selection, and examine</name>
  <files>js/inventory.js, css/inventory.css</files>
  <action>
**js/inventory.js:**
Create a window.Inventory object with:

- Inventory.init() -- called by Game.init() (add the call at end of Game.init). Sets up the inventory bar UI inside #inventory-bar.

- Inventory.pickUp(hotspotData) -- called when player clicks a pickup-type hotspot:
  1. Creates an item object: {id: hotspotData.itemId, name: hotspotData.label, description: hotspotData.itemDescription, icon: hotspotData.itemIcon || null}
  2. Calls Game.addItem(item)
  3. Adds item to the visual inventory bar (renders a div.inventory-slot inside #inventory-bar)
  4. Removes the hotspot from the current scene (the pickup hotspot disappears once taken)
  5. Shows feedback text via Game.showText("Picked up: " + item.name)

- Inventory.render() -- re-renders all items in #inventory-bar from Game.inventory array. Each item is a div.inventory-slot containing:
  - An icon (emoji or text placeholder for now, e.g., first letter of item name in a circle, or use hotspotData.itemIcon if set)
  - The item name below the icon (small text)
  - Click handler: Inventory.select(itemId)
  - Contextmenu (right-click) handler: Inventory.examine(itemId) -- prevent default context menu

- Inventory.select(itemId):
  - If the same item is already selected, deselect it (toggle)
  - Otherwise, set Inventory.selectedItem = itemId
  - Add .selected class to the slot div, remove from others
  - When an item is selected, change cursor to "use" mode globally via Cursor.setMode("use")
  - When deselected, reset cursor via Cursor.reset()

- Inventory.examine(itemId):
  - Finds item in Game.inventory by id
  - Calls Game.showText(item.description)

- Inventory.useOnHotspot(hotspotData):
  - Called from Scene hotspot click handler when player has a selected inventory item and clicks a hotspot
  - If hotspotData.acceptsItem === Inventory.selectedItem:
    - Call hotspotData.onUseItem callback or Game.showText(hotspotData.useItemText || "Used " + Inventory.selectedItem)
    - Call Game.removeItem(Inventory.selectedItem)
    - Re-render inventory bar
    - Clear selection (Inventory.selectedItem = null)
    - If hotspotData has an onUseItem result (like changing a flag), execute it
  - Else:
    - Game.showText(hotspotData.wrongItemText || "That doesn't work here.")

- Inventory.getSelected() -- returns selectedItem id or null

**Update the scene click dispatch (in js/scene.js is already built, but Inventory.pickUp and Inventory.useOnHotspot need to be called):**
Since Plan 01 already built scene.js with graceful degradation (`typeof Inventory !== 'undefined'` checks), the Inventory object just needs to exist on window for those code paths to activate. However, verify and enhance the hotspot click handler in scene.js:

- For "pickup" type: if Inventory exists, call Inventory.pickUp(hotspotData)
- For ANY hotspot click: if Inventory.getSelected() returns a non-null item, call Inventory.useOnHotspot(hotspotData) INSTEAD of the normal click behavior (the player is trying to use their selected item on this hotspot)

If scene.js needs minor adjustments to wire this correctly, make them. Keep changes to scene.js minimal -- only the click dispatch logic.

**Add test pickup hotspots to the existing test scenes in game.js:**
- In test-room-a: add a hotspot {id: "key", type: "pickup", x: 50, y: 60, width: 8, height: 8, label: "Rusty Key", itemId: "rusty-key", itemDescription: "A rusty old key. Looks like it fits something.", itemIcon: "ðŸ”‘"}
- In test-room-b: add a hotspot {id: "locked-box", type: "use", x: 30, y: 50, width: 15, height: 12, label: "Locked Box", acceptsItem: "rusty-key", useItemText: "The key fits! The box opens.", wrongItemText: "That doesn't fit this lock.", onInteract: "A locked wooden box. Needs a key."}

**css/inventory.css:**
- #inventory-bar: flex row, gap 4px, align-items center, padding 4px 12px, background rgba(20,15,10,0.9), border-top 2px solid #444
- .inventory-slot: 56px x 56px, flex-shrink 0, display flex, flex-direction column, align-items center, justify-content center, background rgba(60,50,40,0.7), border 2px solid #555, border-radius 4px, cursor pointer, transition all 0.2s, user-select none
- .inventory-slot:hover: border-color #aaa, background rgba(80,70,60,0.8)
- .inventory-slot.selected: border-color #ffcc00, background rgba(100,90,50,0.8), box-shadow 0 0 8px rgba(255,204,0,0.4)
- .inventory-slot .item-icon: font-size 24px, line-height 1
- .inventory-slot .item-name: font-size 9px, color #ccc, margin-top 2px, text-align center, overflow hidden, white-space nowrap, max-width 52px

Do NOT use ES modules. Attach to window.Inventory.
  </action>
  <verify>
1. Open index.html -- test-room-a shows with hotspots including the key pickup hotspot
2. Click the key hotspot -- "Picked up: Rusty Key" text appears, key icon shows in inventory bar, hotspot disappears from scene
3. Click the key in inventory bar -- it highlights with yellow border, cursor changes to use mode
4. Click the key again in inventory -- deselects, cursor resets
5. Right-click the key in inventory -- description text appears ("A rusty old key...")
6. Navigate to test-room-b (click exit), select the key, click the locked box -- "The key fits!" text appears, key is removed from inventory
7. With no item selected, click the locked box -- "A locked wooden box. Needs a key." examine text appears
8. No console errors throughout
  </verify>
  <done>Inventory bar displays at bottom. Items can be picked up from scenes, selected/deselected by clicking, examined by right-clicking, used on hotspots that accept them (correct item removes from inventory with success text, wrong item shows rejection text). All integrates with the scene engine from Plan 01.</done>
</task>

</tasks>

<verification>
1. Pickup: clicking pickup hotspot adds item to inventory bar and removes hotspot from scene
2. Visual: inventory bar shows item icon and name in styled slot
3. Selection: clicking item toggles selection highlight and cursor mode
4. Examine: right-clicking shows item description text
5. Use correct: selected item + matching hotspot = success text + item removed
6. Use wrong: selected item + non-matching hotspot = rejection text + item kept
7. Integration: scene transitions preserve inventory contents
8. No console errors
</verification>

<success_criteria>
- Pickup hotspot click adds item to inventory bar visual and Game.inventory array
- Inventory slot shows icon and name, highlights on selection
- Right-click examine shows item description via Game.showText
- Use-on-hotspot with correct item: success feedback, item removed
- Use-on-hotspot with wrong item: rejection feedback, item kept
- Cursor switches to "use" mode when item is selected
- Inventory persists across scene changes
</success_criteria>

<output>
After completion, create `.planning/phases/01-engine-systems/01-02-SUMMARY.md`
</output>
