---
phase: 04-art-and-audio
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - js/rooms.js
  - js/game.js
  - js/scene.js
  - js/dialogue.js
  - js/dialogues.js
  - js/cursor.js
  - js/inventory.js
  - css/styles.css
  - css/dialogue.css
  - css/inventory.css
autonomous: true

must_haves:
  truths:
    - "All five game rooms display Gemini-generated background images instead of flat solid colors"
    - "Title screen and ending screen display Gemini-generated background art behind the overlay text"
    - "NPC dialogue shows SVG character portrait images instead of colored circle placeholders"
    - "Cursor icons visually distinguish between look, use, talk, and exit modes using custom SVG cursors"
    - "Inventory items display recognizable SVG icons instead of emoji or first-letter fallbacks"
  artifacts:
    - path: "js/rooms.js"
      provides: "backgroundImage property pointing to Gemini images for all rooms"
    - path: "js/scene.js"
      provides: "Background rendering that applies backgroundImage as CSS background-image"
    - path: "js/dialogue.js"
      provides: "Portrait rendering using SVG data URIs instead of placeholder circles"
    - path: "js/dialogues.js"
      provides: "portraitSVG field for each NPC dialogue tree"
    - path: "css/styles.css"
      provides: "Custom SVG cursor icon definitions for all cursor modes"
    - path: "css/inventory.css"
      provides: "Inventory item icon styling for SVG images"
  key_links:
    - from: "js/rooms.js"
      to: "js/scene.js"
      via: "backgroundImage property rendered as CSS background-image"
      pattern: "backgroundImage.*images/"
    - from: "js/dialogue.js"
      to: "js/dialogues.js"
      via: "portraitSVG field in dialogue tree data"
      pattern: "portraitSVG"
    - from: "js/cursor.js"
      to: "css/styles.css"
      via: "cursor CSS classes with custom SVG URL cursors"
      pattern: "cursor.*url"
---

<objective>
Wire all visual art assets into the game: Gemini-generated background images for all scenes, SVG character portraits for NPC dialogue, custom SVG cursor icons, and SVG inventory item icons. Transform the game from developer placeholders to a polished visual experience.

Purpose: This is the "looks like a real game" plan. Every visual element gets upgraded.
Output: All backgrounds show Gemini images, all dialogue shows SVG portraits, all cursors are custom icons, all inventory items have SVG icons.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-art-and-audio/04-01-SUMMARY.md
@js/rooms.js
@js/game.js
@js/scene.js
@js/dialogue.js
@js/dialogues.js
@js/cursor.js
@js/inventory.js
@css/styles.css
@css/dialogue.css
@css/inventory.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Gemini background images and create SVG character portraits</name>
  <files>js/rooms.js, js/game.js, js/scene.js, js/dialogue.js, js/dialogues.js, css/styles.css, css/dialogue.css</files>
  <action>
**Background images (js/rooms.js):**
Add a `backgroundImage` property to each room definition pointing to the Gemini-generated image:

```javascript
'title-screen': {
  ...
  backgroundImage: 'images/title-screen.png',
  ...
}
'waiting-room': {
  ...
  backgroundImage: 'images/waiting-room.png',
  ...
}
// Same pattern for front-desk, break-room, filing-room, manager-office, ending-screen
```

Keep the existing `background` color property as a fallback (shown while image loads).

**Scene rendering (js/scene.js):**
The Scene.render function already has `backgroundImage` support:
```javascript
if (sceneData.backgroundImage) {
  background.style.backgroundImage = 'url(' + sceneData.backgroundImage + ')';
}
```
This already exists in scene.js. Verify it works with the image paths. The `.scene-background` CSS already has `background-size: cover` and `background-position: center`. No scene.js changes should be needed -- the existing code handles it.

**Title screen overlay (js/game.js):**
In `showTitleScreen`, add a semi-transparent dark backdrop to the title overlay so text is readable over the background image. Add to the overlay element:
```javascript
overlay.style.background = 'radial-gradient(ellipse at center, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.85) 100%)';
```

**Ending screen overlay (js/game.js):**
In `showEndingScreen`, add a warm golden semi-transparent backdrop:
```javascript
overlay.style.background = 'radial-gradient(ellipse at center, rgba(255,200,50,0.15) 0%, rgba(0,0,0,0.7) 100%)';
```

**Character portraits (js/dialogues.js):**
Add a `portraitSVG` property to each dialogue tree. These are inline SVG strings that will be used as data URIs. Keep them simple, geometric, and recognizable at 80x80px.

- **Clerk portrait:** A bored face -- circular head, half-closed eyes (horizontal ovals), flat straight mouth line, small necktie. Color scheme: gray (#6b7280) skin, darker gray features, muted blue tie. The expression should read "dead inside" (appropriate for an afterlife clerk).

- **Filing Cabinet portrait:** A rectangular filing cabinet with a face -- rectangular body, two drawer handles positioned as eyes, a label slot as a flat mouth, a slight frown angle. Color scheme: metallic gray (#78716c) body, darker gray (#57534e) drawers/features, olive green (#84cc16) label. Should look like an actual cabinet that happens to have a grumpy face.

- **Manager portrait:** An overly cheerful face -- circular head, wide-open eyes (large circles), enormous smile, small golden crown or halo floating above. Color scheme: warm purple (#7c3aed) skin (matching existing portrait color), gold (#fbbf24) crown, white teeth in smile. The expression should be unsettlingly enthusiastic.

Each SVG should be a complete `<svg>` element with viewBox="0 0 80 80", containing basic shapes (circles, rects, paths, lines). Keep them under 1KB each. Store as string properties on the dialogue tree objects.

**Portrait rendering (js/dialogue.js):**
In the `renderNode` function, after setting the NPC name, check if the current dialogue tree has a `portraitSVG` property. If it does:
1. Get the portrait container: `document.querySelector('.dialogue-portrait')`
2. Clear its contents
3. Create an `<img>` element with `src` set to a data URI: `'data:image/svg+xml,' + encodeURIComponent(tree.portraitSVG)`
4. Set img width/height to 80px
5. Append the img to the portrait container

If no `portraitSVG` exists, fall back to the existing colored-circle placeholder behavior.

**Portrait CSS (css/dialogue.css):**
Add styling for `.dialogue-portrait img`:
```css
.dialogue-portrait img {
  width: 80px;
  height: 80px;
  border-radius: 8px;
  border: 3px solid #555;
  object-fit: contain;
  background: #2a2a3a;
}
```
  </action>
  <verify>
Open index.html in browser:
1. Title screen shows Gemini image as background with readable text overlay
2. Click "New Game" -- Waiting Room shows Gemini background image (not flat color)
3. Navigate to all 5 rooms -- each shows its distinct Gemini background
4. Talk to any NPC -- dialogue box shows SVG portrait instead of colored circle
5. Complete game to ending -- ending screen shows Gemini image with golden overlay
6. Check console for no errors
  </verify>
  <done>
All 7 scenes display Gemini-generated background images. 3 NPC dialogues display SVG character portraits instead of placeholder circles. Title and ending overlays have semi-transparent backdrops for text readability. No JavaScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create custom cursor icons and inventory item SVG icons</name>
  <files>css/styles.css, js/cursor.js, js/rooms.js, css/inventory.css, js/inventory.js</files>
  <action>
**Custom cursor icons (css/styles.css):**
Replace the CSS cursor property values (help, pointer, crosshair, e-resize) with custom SVG cursor icons. Create inline SVG data URI cursors:

- `.cursor-default`: Simple white arrow pointer with dark outline. SVG: 32x32, white filled arrow shape with 2px dark stroke. Hotspot: 0, 0. Fallback: `default`
- `.cursor-look`: Magnifying glass icon. SVG: 32x32, circle (lens) with a diagonal line (handle), white fill, dark stroke. Hotspot: 10, 10 (center of lens). Fallback: `help`
- `.cursor-use`: Open hand / grab icon. SVG: 32x32, simplified hand shape, white fill, dark stroke. Hotspot: 12, 8 (palm center). Fallback: `pointer`
- `.cursor-talk`: Speech bubble icon. SVG: 32x32, rounded rectangle with a triangular tail at bottom-left, white fill, dark stroke. Hotspot: 14, 10 (center of bubble). Fallback: `crosshair`
- `.cursor-exit`: Arrow pointing right. SVG: 32x32, thick right-pointing arrow, white fill, dark stroke. Hotspot: 24, 16 (arrow tip). Fallback: `e-resize`

Format for each CSS rule:
```css
.cursor-look {
  cursor: url('data:image/svg+xml,ENCODED_SVG') 10 10, help;
}
```

Use `encodeURIComponent()` encoding for special characters in the SVG. The SVG must be URL-safe. Test that the hotspot coordinates point to the logical click point.

**Inventory item SVG icons (js/rooms.js):**
Set the `itemIcon` field on every pickup hotspot to an inline SVG data URI string:

- `bent-paperclip`: A bent paperclip shape (simple wire form, gray metallic color). SVG 40x40.
- `coffee-mug`: A coffee mug outline with steam wisps. SVG 40x40.
- `rubber-stamp`: A rubber stamp shape (handle on top, flat base). SVG 40x40.

Also set icon on the `form-27b` item that's given via dialogue action in dialogues.js. In the `giveItem` action for the cabinet's `offer-coffee` node, add an `icon` property with an SVG data URI:
- `form-27b`: A document/paper icon with "27-B" text. SVG 40x40.

And for `ticket-number` (granted via the ticket machine `onUseItem` callback in rooms.js -- check how items are added there and ensure the icon is set). Actually, the ticket number is a flag (`hasTicketNumber`), not an inventory item. So only 4 inventory items need icons: bent-paperclip, coffee-mug, rubber-stamp, form-27b.

**Inventory rendering (js/inventory.js):**
Update the inventory item rendering to check for `icon` (or `itemIcon`) on the item object. If it's a data URI string, create an `<img>` element with that src instead of using emoji/text. The img should be 40x40px.

**Inventory CSS (css/inventory.css):**
Add styling:
```css
.inventory-item img {
  width: 40px;
  height: 40px;
  object-fit: contain;
  filter: drop-shadow(0 0 2px rgba(255,255,255,0.5));
}
```
  </action>
  <verify>
Open index.html in browser:
1. Hover over different hotspot types -- each shows a distinct custom cursor icon (magnifying glass for look, hand for use, speech bubble for talk, arrow for exit)
2. Pick up bent paperclip -- inventory shows SVG paperclip icon
3. Pick up coffee mug -- inventory shows SVG mug icon
4. Trade coffee for Form 27-B -- inventory shows SVG document icon
5. Find rubber stamp -- inventory shows SVG stamp icon
6. Check console for no errors
  </verify>
  <done>
5 custom cursor SVG icons replace generic CSS cursor keywords (default, look, use, talk, exit). 4 inventory items display recognizable SVG icons in the inventory bar. All cursors have working hotspots and fallbacks. No console errors.
  </done>
</task>

</tasks>

<verification>
1. Open index.html -- title screen shows Gemini image background, not flat #1a1a2e
2. Start game, visit all 5 rooms -- each has a distinct Gemini-generated background image
3. Talk to any NPC -- dialogue box shows SVG portrait (not colored circle with letter)
4. Hover over look/use/talk/exit hotspots -- each shows different custom cursor icon
5. Pick up an item -- inventory shows SVG icon (not emoji or letter)
6. Complete game to ending -- ending screen has Gemini image with golden overlay
7. No JavaScript errors in console throughout
</verification>

<success_criteria>
- All 7 scenes (title, 5 rooms, ending) display Gemini-generated background images
- 3 NPC dialogue portraits are SVG character art (not colored circles)
- 5 cursor modes use custom SVG icons
- 4 inventory items show SVG icons
- Zero console errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-art-and-audio/04-02-SUMMARY.md`
</output>
