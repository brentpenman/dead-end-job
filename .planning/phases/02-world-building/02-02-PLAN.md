---
phase: 02-world-building
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - js/dialogues.js
  - js/rooms.js
  - js/game.js
  - index.html
autonomous: true

must_haves:
  truths:
    - "Clerk speaks with bored, monotone personality in all dialogue branches"
    - "Filing Cabinet speaks with grumpy, territorial personality"
    - "Manager speaks with relentlessly cheerful personality"
    - "Every hotspot shows Morgan's sarcastic internal monologue when examined"
    - "Dialogue choices change based on game state (items held, flags set)"
    - "Humor is dry and bureaucracy-themed throughout"
  artifacts:
    - path: "js/dialogues.js"
      provides: "All NPC dialogue trees (Clerk, Cabinet, Manager)"
      min_lines: 150
    - path: "js/rooms.js"
      provides: "Updated hotspot examine text with Morgan's voice"
  key_links:
    - from: "js/dialogues.js"
      to: "js/dialogue.js"
      via: "Dialogues.registerAll() calls Dialogue.register() for each tree"
      pattern: "Dialogue\\.register"
    - from: "js/game.js"
      to: "js/dialogues.js"
      via: "Game.init() calls Dialogues.registerAll()"
      pattern: "Dialogues\\.registerAll"
---

<objective>
Write all NPC dialogue trees and replace placeholder examine text with Morgan's sarcastic internal monologue, establishing the game's humor and personality.

Purpose: Phase 2's goal is that the world FEELS alive -- NPCs have distinct personalities, every examinable object has flavor text, and the writing has consistent dry humor. Plan 02-01 built the structure; this plan fills in the soul.

Output: js/dialogues.js with 3 NPC dialogue trees; updated js/rooms.js with full examine text for every hotspot; updated game.js init to register dialogues; updated index.html with dialogues.js script.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-world-building/02-01-PLAN.md
@js/game.js
@js/scene.js
@js/dialogue.js
@js/rooms.js
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create js/dialogues.js with all NPC dialogue trees</name>
  <files>js/dialogues.js, js/game.js, index.html</files>
  <action>
Create `js/dialogues.js` using the IIFE + window global pattern. Exposes `window.Dialogues` with one method: `Dialogues.registerAll()` that calls `Dialogue.register(id, treeData)` for each NPC.

**Update index.html:** Add `<script src="js/dialogues.js"></script>` AFTER dialogue.js and BEFORE the inline DOMContentLoaded script. Script order: rooms.js, game.js, scene.js, cursor.js, inventory.js, dialogue.js, dialogues.js.

**Update js/game.js init():** After `Dialogue.init()`, add `Dialogues.registerAll()`.

**Also in game.js:** Remove the `registerDefaultDialogues` call from `Dialogue.init()` or ensure it doesn't conflict. The bob-intro test dialogue from Phase 1 should be removed from dialogue.js's `registerDefaultDialogues` method -- replace the body of `registerDefaultDialogues` with just a comment: `// Default dialogues removed -- real dialogues registered via Dialogues.registerAll()`.

Wait -- do NOT modify dialogue.js directly (it's not in files_modified and Plan 02-01 doesn't own it). Instead, the approach: leave registerDefaultDialogues alone (it registers bob-intro which is harmless since no hotspot references it anymore). The real dialogues get registered by Dialogues.registerAll() which runs after Dialogue.init().

**DIALOGUE TREES:**

Each tree uses the format established in js/dialogue.js: `{ id, npcName, portrait, nodes: { nodeId: { text, choices: [{ text, next, condition?, action? }] } } }`.

The dialogue tree `id` values must match the `dialogueId` values on NPC hotspots in rooms.js: `'clerk'`, `'cabinet'`, `'manager'`.

### Clerk Dialogue Tree (id: 'clerk')
**Personality:** Bone-deep bored. Has processed souls for eternity. Speaks in monotone. Uses bureaucratic jargon. Not mean, just completely checked out. Think DMV worker who stopped caring centuries ago.

**Portrait color hint:** For the portrait-placeholder background color, set a muted gray-blue (will use placeholder circle with "C" initial per Phase 1 system).

Nodes:

**'start'** (first visit, no ticket):
- Text: "Next. ...Oh, you don't have a number. You need to take a number from the machine in the Waiting Room. Policy is policy."
- Choices:
  - "But there's nobody else here." -> 'nobody'
  - "Where do I even start?" -> 'directions'
  - Condition {hasFlag: 'hasTicketNumber'}: "I have a number." -> 'has-number'
  - Condition {hasItem: 'form-27b'}: "I have Form 27-B." -> 'has-form'

**'nobody':**
- Text: "Doesn't matter. The system requires a number. I don't make the rules. I just... exist near them."
- Choices:
  - "Where do I even start?" -> 'directions'

**'directions':**
- Text: "Ticket machine. Waiting Room. Take a number. Come back. I'll be here. I'm always here."
- Choices: [] (auto-close with [Leave])

**'has-number':**
- Text: "*Sigh.* Number 2,147,483,647. That's you? Fine. You need Form 27-B filed and stamped. Filing Room has the form. Manager stamps it."
- Choices:
  - "That's a lot of numbers ahead of me." -> 'big-number'
  - "Where's the Filing Room?" -> 'filing-directions'
  - Action on entry: { setFlag: { clerkGaveDirections: true } }

**'big-number':**
- Text: "Everyone's number is that. The machine only prints one number. Budget cuts."
- Choices:
  - "Where's the Filing Room?" -> 'filing-directions'

**'filing-directions':**
- Text: "Through here, door on the right. The Filing Room has your form. Manager's Office is upstairs for the stamp. Good luck. Or don't. Luck is a construct."
- Choices: [] (auto-close)

**'has-form':**
- Text: "Form 27-B. Good. Now you need the Manager to stamp it. Office is through the door behind me. Try not to be too alive about it."
- Choices:
  - "Thanks for all your help." -> 'thanks'
  - Action on entry: { setFlag: { clerkSentToManager: true } }

**'thanks':**
- Text: "Don't mention it. Literally. I have a quota of emotional interactions per century and I'm already over."
- Choices: [] (auto-close)

### Filing Cabinet Dialogue Tree (id: 'cabinet')
**Personality:** Grumpy, territorial, protective of files. Speaks with gravelly authority. Hates being opened. Treats files like children. Think cranky old librarian who IS the library.

Nodes:

**'start':**
- Text: "WHAT. Do you KNOW what time it is? It's ALWAYS filing time and I am BUSY. State your business or get out of my drawer."
- Choices:
  - "I need Form 27-B." -> 'need-form'
  - "You're... a talking filing cabinet?" -> 'talking'
  - "Nice drawers." -> 'nice-drawers'

**'need-form':**
- Text: "Form 27-B? 27-B?! That's in my THIRD drawer. Do you know how much it HURTS to open the third drawer? I want something in return."
- Choices:
  - "What do you want?" -> 'want'
  - "Can't you just give it to me?" -> 'just-give'
  - Condition {hasItem: 'coffee-mug'}: "Would a nice cup of coffee help?" -> 'offer-coffee'

**'want':**
- Text: "Something warm. Something comforting. I've been cold and metal for three hundred years. Bring me a hot beverage and MAYBE I'll consider it."
- Choices:
  - Condition {hasItem: 'coffee-mug'}: "I have coffee right here." -> 'offer-coffee'

**'just-give':**
- Text: "JUST give it?! Do I come to YOUR afterlife and demand YOU open YOUR third drawer?! No. Bring me something worth my while."
- Choices:
  - "What do you want?" -> 'want'

**'talking':**
- Text: "You're a talking HUMAN and I don't see ME making a big deal about it. Now. Did you need something or are you just here to gawk?"
- Choices:
  - "I need Form 27-B." -> 'need-form'
  - "Fair point." -> (close)

**'nice-drawers':**
- Text: "...I'm going to pretend you didn't say that. Is there something you actually NEED?"
- Choices:
  - "I need Form 27-B." -> 'need-form'

**'offer-coffee':**
- Text: "Is that... is that COFFEE? Oh. Oh that's lovely. That's the warmest thing anyone's done for me in centuries. ...Fine. Here's your stupid form."
- Choices:
  - "Thanks, you old filing cabinet." -> 'thanks'
  - Action on entry: { removeItem: 'coffee-mug', giveItem: { id: 'form-27b', name: 'Form 27-B', description: 'An official afterlife processing form. Needs a stamp.', icon: null }, setFlag: { gotForm27B: true } }

**'thanks':**
- Text: "*sniff* Nobody ever brings ME coffee. ...Now get out before I change my mind and refile you under 'Miscellaneous Nuisances.'"
- Choices: [] (auto-close)

### Manager Dialogue Tree (id: 'manager')
**Personality:** Relentlessly, aggressively cheerful. Loves their job. Uses corporate motivational language unironically. Genuinely wants to help. The most unsettling person in the afterlife because they ENJOY bureaucracy. Think Michael Scott meets a motivational poster.

Nodes:

**'start':**
- Text: "Well HELLO there, new soul! Welcome to my office! Isn't it GREAT? I just love processing days! What can I do for you today?"
- Choices:
  - "I need Form 27-B stamped." -> 'need-stamp'
  - "How can you be so cheerful?" -> 'cheerful'
  - "Nice office." -> 'office'
  - Condition {hasItem: 'form-27b'}: "Here's my Form 27-B." -> 'have-form'
  - Condition {hasItem: 'rubber-stamp'}: "I found this stamp." -> 'have-stamp'
  - Condition {hasItem: 'form-27b', hasItem2: 'rubber-stamp'}: "I have the form AND the stamp." -> 'have-both'

NOTE on conditions: The engine only supports one condition per choice (hasItem, hasFlag, notFlag). For the "have both" option, use a condition `{ hasFlag: 'readyToStamp' }` -- Phase 3 will set this flag when both items are present. For now, include this choice with condition `{ hasFlag: 'readyToStamp' }`.

Revised choices for 'start':
  - "I need Form 27-B stamped." -> 'need-stamp'
  - "How can you be so cheerful?" -> 'cheerful'
  - "Nice office." -> 'office'
  - Condition {hasItem: 'form-27b'}: "Here's my Form 27-B." -> 'have-form-only'
  - Condition {hasFlag: 'readyToStamp'}: "I have the form AND the stamp. Let's do this." -> 'stamp-form'

**'need-stamp':**
- Text: "Oh ABSOLUTELY! I LIVE for stamping! Well, I used to live. Now I exist for stamping! You'll need Form 27-B from Filing, and the official stamp. I seem to have misplaced mine -- check the Break Room!"
- Choices:
  - "You lost the stamp?" -> 'lost-stamp'
  - "I'll go find them." -> (close)

**'lost-stamp':**
- Text: "I prefer to say it's on an ADVENTURE! Everything's an adventure if you have the right attitude! Which I ALWAYS do!"
- Choices: [] (auto-close)

**'cheerful':**
- Text: "How can I NOT be?! Every day is a chance to help a soul move on to the next great thing! Plus the dental plan here is INCREDIBLE. Not that I need teeth anymore!"
- Choices:
  - "That's... unsettling." -> 'unsettling'
  - "I need Form 27-B stamped." -> 'need-stamp'

**'unsettling':**
- Text: "I get that a lot! But you know what I always say -- ATTITUDE is the difference between an ORDEAL and an ADVENTURE! Isn't that FUN?"
- Choices: [] (auto-close)

**'office':**
- Text: "Thank you SO much! I decorated it myself! That motivational plaque? Reads 'Every soul counts!' Because they DO! I count them! It's part of my job!"
- Choices:
  - "I need Form 27-B stamped." -> 'need-stamp'

**'have-form-only':**
- Text: "Ooh, Form 27-B! WONDERFUL! But I can't stamp it without my stamp! I think I left it in the Break Room. Could you grab it for me? PLEASE?"
- Choices:
  - "Sure, I'll find it." -> (close)

**'stamp-form':**
- Text: "OH BOY OH BOY! Form AND stamp! This is the BEST day of my afterlife! Let me just... *STAMP* ...APPROVED! You're FREE to go! CONGRATULATIONS!"
- Choices:
  - "Finally. Thanks." -> 'goodbye'
  - Action on entry: { setFlag: { formStamped: true } }

NOTE: Phase 3 will wire the actual ending trigger to the 'goodbye' node or the 'stamp-form' action. For now, just set the flag.

**'goodbye':**
- Text: "It was SO great meeting you, Morgan! Tell the next plane of existence I said HI! And remember -- every end is just a NEW BEGINNING! ...I need to get out more."
- Choices: [] (auto-close)
- Action on entry: Phase 3 will add the ending trigger here. For now, just close.

**CODE STRUCTURE:**

```javascript
(function() {
  'use strict';

  var dialogueTrees = {
    'clerk': { /* tree data */ },
    'cabinet': { /* tree data */ },
    'manager': { /* tree data */ }
  };

  window.Dialogues = {
    registerAll: function() {
      for (var id in dialogueTrees) {
        if (dialogueTrees.hasOwnProperty(id)) {
          Dialogue.register(id, dialogueTrees[id]);
        }
      }
      console.log('Registered', Object.keys(dialogueTrees).length, 'dialogue trees');
    }
  };
})();
```

**WRITING QUALITY:**
- Each NPC MUST have a distinct voice that's immediately recognizable
- Clerk: Short sentences. Periods. Monotone. Existential resignation.
- Cabinet: CAPS for emphasis. Rhetorical questions. Territorial language. Gruff but secretly lonely.
- Manager: Exclamation marks! CAPS for enthusiasm! Corporate-speak. Puns. Unsettlingly positive.
- Keep dialogue nodes SHORT (1-3 sentences max). This is a game, not a novel.
- Every choice the player makes should feel like it has a personality response.
  </action>
  <verify>
1. Open game in browser, navigate to Front Desk, click Clerk -- dialogue opens with bored personality
2. Navigate to Filing Room, click Cabinet -- dialogue opens with grumpy personality
3. Navigate to Manager's Office, click Manager -- dialogue opens with cheerful personality
4. Each dialogue has at least 4 nodes with branching paths
5. Conditional choices are present (some hidden until conditions met)
6. [Leave] button works on all dialogue nodes
7. Console shows "Registered 3 dialogue trees" on load
8. No JS errors in console
  </verify>
  <done>Three NPC dialogue trees registered and functional, each with distinct personality, branching paths, and state-aware choices</done>
</task>

<task type="auto">
  <name>Task 2: Replace all hotspot examine text with Morgan's sarcastic monologue</name>
  <files>js/rooms.js</files>
  <action>
Update every `onInteract` string in js/rooms.js to replace the placeholder text from Plan 02-01 with Morgan's sarcastic internal monologue.

**MORGAN'S VOICE:**
Morgan Gray is a recently deceased office worker. Dry, sarcastic, self-aware. Not mean-spirited -- more resigned and sardonic. Thinks in pop culture references and dark humor. The kind of person who copes with being dead by making jokes about it.

**Guidelines:**
- Each examine text should be 1-2 sentences MAX
- Must be in Morgan's first-person voice (internal thought)
- Should reference the afterlife/death/bureaucracy theme where possible
- Mix of observational humor, sarcasm, and occasional genuine reaction
- NO emoji, NO exclamation marks (those are the Manager's thing)
- Avoid repeating the same joke structure

**EXACT TEXT FOR EACH HOTSPOT:**

### Waiting Room:
- `ticket-machine`: "A take-a-number machine. It's jammed. Even in death, the machines don't work."
- `poster-1`: "A motivational poster reads 'Hang in there!' Underneath, someone scrawled 'for eternity.'"
- `poster-2`: "'Every day is a gift!' ...The return policy here is terrible though."
- `waiting-chairs`: "Plastic chairs bolted to the floor. At least I can't feel my legs anymore. Wait, can I?"
- `water-cooler`: "The water cooler is empty. Figures. Even the water moved on before I did."

### Front Desk:
- `desk-bell`: "A service bell. I ring it. Nothing happens. I ring it again. Still nothing. Truly, this is the afterlife."
- `next-sign`: "A neon 'NEXT' sign that's been stuck on the same number since 1987. Comforting."
- `paperwork-pile`: "A mountain of paperwork that would give a living person a heart attack. Good thing that ship has sailed."

### Break Room:
- `coffee-machine`: "A coffee machine that apparently dispenses 'existential dread' in three flavors. I'll take a dark roast."
- `vending-machine`: "A vending machine. Something's stuck behind the glass. The afterlife really is just one big metaphor."
- `break-table`: "A break table covered in coffee rings and centuries of despair. So, a regular break table."
- `lost-found-box`: "A Lost and Found box. 'Lost: my will to live. Found: irony.'"
- `rubber-stamp` (itemDescription, not onInteract): "An official rubber stamp. Property of the Manager's Office. Probably shouldn't have been in the Lost and Found."

### Filing Room:
- `cabinet-row-left`: "Rows and rows of filing cabinets. Each one holds someone's entire existence. Mine's probably misfiled under 'G' for 'Gray' or 'Grievous Accident.'"
- `cabinet-row-right`: "More filing cabinets. These ones are labeled 'H through N.' I wonder if they're all this chatty."
- `dusty-floor`: "The floor is covered in a fine layer of dust. At least something here has settled."

### Manager's Office:
- `manager-desk`: "A desk covered in motivational tchotchkes and a '#1 Boss' mug. Someone drank the Kool-Aid. And then died. And then kept drinking it."
- `motivational-plaque`: "A plaque reads 'Every Soul Counts!' with a tally mark system. There are... a lot of tally marks."
- `potted-plant`: "A fake potted plant. Even the plants here aren't alive. I'd say that's poetic if it weren't so on the nose."

**Implementation:** Open js/rooms.js, find each hotspot's `onInteract` field, and replace the placeholder string with the corresponding text above. For the rubber-stamp pickup hotspot, update the `itemDescription` field (pickup hotspots don't have onInteract -- they have itemDescription which shows when right-click examining the item in inventory).

Also: For the `desk-bell` hotspot in front-desk, add a `type: 'use'` instead of 'look'. The bell is something you interact with, but it doesn't DO anything. Actually -- keep it as 'look' since clicking it just shows the examine text. The humor is in the text itself.

Also: For the `coffee-machine` in the break room, this should have an additional interaction for Phase 3 (getting coffee). For now, leave it as type 'look'. Phase 3 will change the type when wiring puzzles.

**ALSO ADD** a `coffee-mug` pickup hotspot to the break-room if it doesn't exist in rooms.js yet. Place it near the coffee machine:
- `coffee-mug`: type 'pickup', x:20, y:50, width:6, height:8, label "Coffee Mug", itemId: 'coffee-mug', itemDescription: "A mug that says 'I Survived the Afterlife and All I Got Was This Lousy Mug.' Classic.", itemIcon: null

This mug is what the player trades to the Filing Cabinet for Form 27-B.
  </action>
  <verify>
1. Open game in browser, navigate to each room
2. Click every 'look' hotspot and verify the examine text matches the specified Morgan monologue
3. Verify text is witty, in-character, and references the afterlife theme
4. Verify all 5 rooms have complete examine text (no placeholders remaining)
5. Check that coffee-mug pickup exists in Break Room
6. Right-click coffee-mug in inventory to verify its description
7. Right-click rubber-stamp in inventory to verify its updated description
  </verify>
  <done>Every hotspot in all 5 rooms displays Morgan's sarcastic examine text, coffee-mug pickup added, no placeholder text remains</done>
</task>

</tasks>

<verification>
1. Load game -- title screen appears, click New Game
2. **Waiting Room:** Click all hotspots, verify Morgan's voice in each examine text. Verify sarcasm and afterlife humor.
3. Navigate to **Front Desk:** Click Clerk NPC, verify bored dialogue. Click all look hotspots, verify examine text.
4. Navigate to **Break Room:** Click all hotspots. Pick up Coffee Mug, right-click to examine it in inventory. Verify examine text.
5. Navigate to **Filing Room:** Click Filing Cabinet NPC, verify grumpy dialogue. Click look hotspots.
6. Navigate to **Manager's Office:** Click Manager NPC, verify cheerful dialogue. Click look hotspots.
7. Verify dialogue state conditions: Clerk shows different options based on whether player has ticket number (flag).
8. Verify all three NPCs have DISTINCT personality voices that are immediately distinguishable.
9. Verify humor is dry and consistent across all examine text.
10. No JS errors in console.
</verification>

<success_criteria>
- All 3 NPCs have complete, personality-driven dialogue trees with branching
- Clerk sounds bored, Cabinet sounds grumpy, Manager sounds cheerful -- distinctly different voices
- Every examinable hotspot shows Morgan's sarcastic internal monologue (no placeholders)
- Dialogue includes state-aware choices (hasItem, hasFlag conditions)
- Humor is dry, afterlife-bureaucracy themed, and consistent throughout
- Coffee mug pickup exists in Break Room for puzzle chain
</success_criteria>

<output>
After completion, create `.planning/phases/02-world-building/02-02-SUMMARY.md`
</output>
