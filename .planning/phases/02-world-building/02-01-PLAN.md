---
phase: 02-world-building
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/rooms.js
  - js/game.js
  - index.html
  - css/styles.css
autonomous: true

must_haves:
  truths:
    - "Title screen shows game name and a New Game button that starts the game"
    - "Player can navigate through all five rooms using exit hotspots"
    - "Each room has distinct hotspots matching its identity (ticket machine in Waiting Room, bell at Front Desk, etc.)"
    - "Ending screen displays when triggered and offers to play again"
    - "Navigation graph connects rooms correctly: Waiting Room <-> Front Desk <-> Break Room / Filing Room / Manager's Office"
  artifacts:
    - path: "js/rooms.js"
      provides: "All room/scene definitions, title screen, ending screen"
      min_lines: 150
    - path: "js/game.js"
      provides: "Updated init to load real rooms instead of test scenes"
    - path: "index.html"
      provides: "Script tag for rooms.js"
  key_links:
    - from: "js/rooms.js"
      to: "js/game.js"
      via: "Rooms.getAll() called in Game.init()"
      pattern: "Rooms\\.getAll"
    - from: "js/game.js"
      to: "js/rooms.js"
      via: "GameState.scenes populated from Rooms data"
      pattern: "GameState\\.scenes"
---

<objective>
Define all game rooms, the title screen, and the ending screen as scene data structures that the Phase 1 engine can render.

Purpose: The engine from Phase 1 renders scenes from data. This plan provides ALL the data -- five rooms with hotspots and exits forming a connected navigation graph, plus a title screen and ending screen. After this plan, every room is visitable and every hotspot is clickable (even if examine text and dialogue content are placeholders that Plan 02-02 fills in).

Output: js/rooms.js with all scene definitions; updated js/game.js to load real rooms; updated index.html to include rooms.js.
</objective>

<execution_context>
@/Users/brent/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@js/game.js
@js/scene.js
@js/inventory.js
@js/dialogue.js
@js/cursor.js
@css/styles.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create js/rooms.js with all scene definitions</name>
  <files>js/rooms.js</files>
  <action>
Create `js/rooms.js` using the IIFE + window global pattern matching the existing codebase (see js/game.js, js/scene.js for examples).

The file exposes `window.Rooms` with one method: `Rooms.getAll()` that returns an object keyed by scene ID containing all scene definitions.

**IMPORTANT:** Hotspot `onInteract` text in this plan should be SHORT PLACEHOLDER text (1 sentence). Plan 02-02 will replace all examine text with Morgan's sarcastic monologue. Dialogue IDs reference trees that Plan 02-02 will register. This plan focuses on STRUCTURE (positions, types, connections), not CONTENT.

**Scene definitions to create:**

### 1. Title Screen (`title-screen`)
- name: "Dead End Job"
- background: '#1a1a2e' (dark blue-purple)
- NO hotspots -- title screen uses a special rendering path (see Task 2)
- Flag: `isTitle: true`

### 2. Waiting Room (`waiting-room`)
- name: "Waiting Room"
- background: '#2a3a2a' (muted green -- fluorescent office)
- Hotspots:
  - `ticket-machine`: type 'use', x:65, y:30, width:12, height:35, label "Ticket Machine", onInteract: "A broken take-a-number machine.", acceptsItem: null (puzzle wiring in Phase 3)
  - `poster-1`: type 'look', x:10, y:15, width:12, height:18, label "Motivational Poster", onInteract: "A poster."
  - `poster-2`: type 'look', x:25, y:12, width:10, height:15, label "Another Poster", onInteract: "Another poster."
  - `waiting-chairs`: type 'look', x:35, y:55, width:25, height:25, label "Waiting Chairs", onInteract: "Plastic chairs."
  - `water-cooler`: type 'look', x:5, y:40, width:8, height:30, label "Water Cooler", onInteract: "A water cooler."
  - `exit-front-desk`: type 'exit', x:80, y:25, width:15, height:55, target: 'front-desk', label "Front Desk"

### 3. Front Desk (`front-desk`)
- name: "Front Desk"
- background: '#3a2a2a' (muted red-brown -- bureaucratic)
- Hotspots:
  - `clerk-npc`: type 'talk', x:35, y:20, width:15, height:45, label "The Clerk", dialogueId: 'clerk'
  - `desk-bell`: type 'look', x:55, y:55, width:8, height:8, label "Service Bell", onInteract: "A bell."
  - `next-sign`: type 'look', x:30, y:8, width:20, height:10, label '"NEXT" Sign', onInteract: "A sign."
  - `paperwork-pile`: type 'look', x:60, y:40, width:15, height:20, label "Pile of Paperwork", onInteract: "Paperwork."
  - `exit-waiting`: type 'exit', x:0, y:30, width:10, height:50, target: 'waiting-room', label "Waiting Room"
  - `exit-break`: type 'exit', x:85, y:60, width:12, height:30, target: 'break-room', label "Break Room"
  - `exit-filing`: type 'exit', x:85, y:15, width:12, height:30, target: 'filing-room', label "Filing Room"
  - `exit-manager`: type 'exit', x:45, y:0, width:15, height:12, target: 'manager-office', label "Manager's Office"

### 4. Break Room (`break-room`)
- name: "Break Room"
- background: '#2a2a3a' (muted blue -- dingy break room)
- Hotspots:
  - `coffee-machine`: type 'look', x:15, y:25, width:12, height:30, label "Coffee Machine", onInteract: "A coffee machine."
  - `vending-machine`: type 'use', x:60, y:15, width:15, height:45, label "Vending Machine", onInteract: "A vending machine.", acceptsItem: null (Phase 3)
  - `break-table`: type 'look', x:30, y:50, width:25, height:25, label "Break Table", onInteract: "A table."
  - `lost-found-box`: type 'look', x:80, y:60, width:12, height:18, label "Lost & Found Box", onInteract: "A box."
  - `rubber-stamp`: type 'pickup', x:42, y:42, width:6, height:6, label "Rubber Stamp", itemId: 'rubber-stamp', itemDescription: 'An official-looking rubber stamp.', itemIcon: 'STAMP' (use text -- emoji deferred to Phase 4)
  - `exit-front-desk`: type 'exit', x:0, y:30, width:10, height:50, target: 'front-desk', label "Front Desk"

NOTE on rubber-stamp: This pickup hotspot will be HIDDEN initially (Phase 3 gating). For now in Phase 2, it should exist in the scene data. Phase 3 will add the visibility gating logic. Use itemIcon: null so the first-letter fallback ("R") renders.

### 5. Filing Room (`filing-room`)
- name: "Filing Room"
- background: '#3a3a2a' (muted yellow-brown -- dusty archives)
- Hotspots:
  - `cabinet-npc`: type 'talk', x:40, y:15, width:18, height:50, label "Sentient Filing Cabinet", dialogueId: 'cabinet'
  - `cabinet-row-left`: type 'look', x:5, y:10, width:15, height:60, label "Filing Cabinets (Left)", onInteract: "Cabinets."
  - `cabinet-row-right`: type 'look', x:75, y:10, width:15, height:60, label "Filing Cabinets (Right)", onInteract: "Cabinets."
  - `dusty-floor`: type 'look', x:25, y:70, width:40, height:15, label "Dusty Floor", onInteract: "The floor."
  - `exit-front-desk`: type 'exit', x:0, y:30, width:10, height:50, target: 'front-desk', label "Front Desk"

### 6. Manager's Office (`manager-office`)
- name: "Manager's Office"
- background: '#2e2a3e' (dark purple -- slightly nicer)
- Hotspots:
  - `manager-npc`: type 'talk', x:35, y:15, width:15, height:45, label "The Manager", dialogueId: 'manager'
  - `manager-desk`: type 'look', x:25, y:50, width:30, height:20, label "Manager's Desk", onInteract: "A desk."
  - `motivational-plaque`: type 'look', x:65, y:15, width:12, height:12, label "Motivational Plaque", onInteract: "A plaque."
  - `potted-plant`: type 'look', x:75, y:55, width:10, height:25, label "Potted Plant", onInteract: "A plant."
  - `exit-front-desk`: type 'exit', x:0, y:30, width:10, height:50, target: 'front-desk', label "Front Desk"

### 7. Ending Screen (`ending-screen`)
- name: "The End"
- background: '#1a2e1a' (dark green -- peaceful)
- NO hotspots -- uses special rendering (see Task 2)
- Flag: `isEnding: true`

**Code structure:**

```javascript
(function() {
  'use strict';

  var rooms = {
    'title-screen': { /* ... */ },
    'waiting-room': { /* ... */ },
    'front-desk': { /* ... */ },
    'break-room': { /* ... */ },
    'filing-room': { /* ... */ },
    'manager-office': { /* ... */ },
    'ending-screen': { /* ... */ }
  };

  window.Rooms = {
    getAll: function() {
      return rooms;
    }
  };
})();
```

For the rubber-stamp pickup, use `itemIcon: null` (not the string 'STAMP'). The inventory system already handles null icons with the first-letter fallback.
  </action>
  <verify>
Read js/rooms.js and confirm:
1. File uses IIFE + window.Rooms pattern
2. All 7 scenes exist with correct IDs
3. Every hotspot has: id, type, x, y, width, height, label
4. Exit hotspots have valid `target` values pointing to other scene IDs
5. Navigation is bidirectional (every exit has a return path)
6. Title screen and ending screen have isTitle/isEnding flags
7. NPC hotspots have dialogueId values ('clerk', 'cabinet', 'manager')
8. Pickup hotspot (rubber-stamp) has itemId, itemDescription, itemIcon: null
  </verify>
  <done>js/rooms.js exists with all 7 scenes, correct hotspot definitions, and bidirectional navigation graph</done>
</task>

<task type="auto">
  <name>Task 2: Update game.js to load real rooms and handle title/ending screens</name>
  <files>js/game.js, index.html, css/styles.css</files>
  <action>
**Update index.html:** Add `<script src="js/rooms.js"></script>` BEFORE `<script src="js/game.js"></script>` so Rooms is available when Game.init() runs. The script order must be: rooms.js, game.js, scene.js, cursor.js, inventory.js, dialogue.js.

**Update js/game.js:**

1. **Remove `registerTestScenes` entirely.** Delete the test-room-a and test-room-b scene definitions and the method.

2. **Add `registerRooms` method** that calls `Rooms.getAll()` and copies each scene into `GameState.scenes`:

```javascript
registerRooms: function() {
  var allRooms = Rooms.getAll();
  for (var id in allRooms) {
    if (allRooms.hasOwnProperty(id)) {
      GameState.scenes[id] = allRooms[id];
    }
  }
  console.log('Registered', Object.keys(GameState.scenes).length, 'rooms');
},
```

3. **Update `init` method:**
   - Change `currentScene` default from `'test-room-a'` to `'title-screen'`
   - Replace `this.registerTestScenes()` with `this.registerRooms()`
   - After `Scene.render(...)`, check if the scene has `isTitle` flag. If so, call `this.showTitleScreen()`

4. **Add `showTitleScreen` method:**
   - Creates an overlay div with class `title-overlay` positioned over the scene
   - Contains: h1 "Dead End Job", p subtitle "A Pointless Adventure in the Afterlife", button "New Game"
   - Button click calls `Game.startGame()`
   - Appends overlay to `#scene-container`

5. **Add `startGame` method:**
   - Removes the title overlay
   - Calls `Game.changeScene('waiting-room')`

6. **Add `showEndingScreen` method:**
   - Creates overlay div with class `ending-overlay` positioned over the scene
   - Contains: h1 "FORM 27-B: APPROVED", p "Congratulations! You've successfully navigated the Afterlife Processing Department.", p "Morgan Gray can finally move on... to whatever comes next.", button "Play Again"
   - Button click calls `Game.restartGame()`
   - Appends overlay to `#scene-container`

7. **Add `restartGame` method:**
   - Resets GameState: `GameState.inventory = []`, `GameState.flags = {}`, `GameState.currentScene = 'title-screen'`
   - Calls `Scene.render('title-screen')`
   - Calls `Inventory.render()` if available
   - Calls `this.showTitleScreen()`

8. **Add `triggerEnding` method:**
   - Calls `Game.changeScene('ending-screen')`
   - After the 400ms scene transition, calls `this.showEndingScreen()`

**Update css/styles.css:** Add styles for title and ending overlays:

```css
/* Title screen overlay */
.title-overlay, .ending-overlay {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 5;
  text-align: center;
}

.title-overlay h1, .ending-overlay h1 {
  font-size: 48px;
  color: #ffcc00;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  margin-bottom: 16px;
}

.title-overlay p, .ending-overlay p {
  font-size: 18px;
  color: #ccc;
  margin-bottom: 24px;
  max-width: 500px;
}

.title-overlay button, .ending-overlay button {
  padding: 14px 40px;
  font-size: 20px;
  background: #ffcc00;
  color: #1a1a2e;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: transform 0.15s, background 0.15s;
}

.title-overlay button:hover, .ending-overlay button:hover {
  background: #ffe066;
  transform: scale(1.05);
}
```

**IMPORTANT:** Keep ALL existing Game methods intact (addItem, removeItem, hasItem, getInventory, setFlag, getFlag, showText, getScene, getCurrentSceneId, changeScene). Only modify `init` and remove `registerTestScenes`.
  </action>
  <verify>
1. Open index.html in browser
2. Title screen renders with "Dead End Job" heading, subtitle, and "New Game" button
3. Clicking "New Game" transitions to Waiting Room
4. All exits work: navigate through every room and back
5. Navigation graph is correct: Waiting Room -> Front Desk -> Break Room / Filing Room / Manager's Office (and back)
6. Console shows no errors
7. Run in browser console: `Game.triggerEnding()` and verify ending screen appears with "Play Again" button
8. Click "Play Again" and verify game restarts at title screen
  </verify>
  <done>Game starts at title screen, all 5 rooms are navigable via exits, ending screen works with restart, no console errors</done>
</task>

</tasks>

<verification>
1. Load index.html -- title screen appears with game name and New Game button
2. Click New Game -- transitions to Waiting Room with 6 hotspots
3. Click "Front Desk" exit -- transitions to Front Desk with 8 hotspots
4. Click each exit from Front Desk: Break Room (6 hotspots), Filing Room (5 hotspots), Manager's Office (5 hotspots)
5. Navigate back from each room to Front Desk, then back to Waiting Room
6. Hover over hotspots -- cursor changes appropriately (look, talk, use, exit)
7. Click NPC hotspots -- dialogue attempts to open (may show error if trees not registered yet, that's OK)
8. Run `Game.triggerEnding()` in console -- ending screen appears
9. Click "Play Again" -- returns to title screen
10. Console has no errors except missing dialogue trees (expected, Plan 02-02 adds them)
</verification>

<success_criteria>
- Title screen displays and New Game button starts the game
- All 5 game rooms render with their hotspots visible
- Every exit connects to the correct room and return exits work
- Ending screen renders when triggered and Play Again restarts the game
- Existing engine features (cursor modes, inventory, text display) still work
</success_criteria>

<output>
After completion, create `.planning/phases/02-world-building/02-01-SUMMARY.md`
</output>
